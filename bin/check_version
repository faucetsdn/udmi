#!/bin/bash -ex
#
# This script intentionally runs silent if there is no version mismatch found.
#

ROOT_DIR=$(dirname $0)/..
cd $ROOT_DIR

branch=master
origin=`git remote -v | fgrep faucetsdn/udmi | awk '{print $1}' | uniq`

if [[ -z $origin ]]; then
    git remote -v
    echo No git origin count, skipping version check.
    exit 1
fi

git fetch $origin --tags 2>/dev/null
upstream_ver=`git describe $origin/$branch --abbrev=0`
current_ver=`git describe HEAD --abbrev=0 || echo unknown`

if [[ $current_ver != $upstream_ver ]]; then
    echo
    echo Local UDMI version $current_ver does not match upstream version $upstream_ver
    echo Please consider updating as needed.
    echo
fi
