#!/bin/bash -e

# Fix sort order difference on different platforms.
export LC_ALL=C

if [[ $1 == check ]]; then
    echo Checking gencode hash...
    files=`find gencode/ -type f | sort`
    sha256sum $files > /tmp/gencode.hash
    diff /tmp/gencode.hash .gencode_hash.txt
    exit 0
fi

bin/gencode_java
bin/gencode_python gencode/python schema/*.json
bin/gencode_docs

echo Updating gencode hash...
files=`find gencode/ -type f | sort`
sha256sum $files > .gencode_hash.txt
