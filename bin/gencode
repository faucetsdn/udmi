#!/bin/bash -e

# Fix sort order difference on different platforms.
export LC_ALL=C

bin/gencode_java
bin/gencode_python gencode/python schema/*.json
bin/gencode_docs

files=`find gencode/ -type f | sort`

if [[ $1 == check ]]; then
    echo Checking gencode hash...
    sha256sum $files > /tmp/gencode.hash
    diff /tmp/gencode.hash .gencode_hash.txt
    echo Checking gencode docs...
    bin/gencode_docs check_schema
    bin/gencode_docs check_links
else
    echo Updating gencode hash...
    files=`find gencode/ -type f | sort`
    sha256sum $files > .gencode_hash.txt
fi

echo Done with gencode $*
