#!/bin/bash -ex

archive=$1
shift

sites_in=sites/udmi_site_model_*/
sites_out=sites/udmi_site_model/out

rm -rf out $sites_out
rm -rf out_* $sites_in
rm -f *_udmi-support_*.tgz

unzip -o $archive
ls *sequencer*.tgz | xargs -n 1 tar -xzf

find $sites_in -name out-seq -print -exec rsync -ah {}/ $sites_out/ \;

src_count=$(find $sites_in/out-seq -name sequence.md | wc -l)
dst_count=$(find $sites_out -name sequence.md | wc -l)

if [[ $src_count != $dst_count ]]; then
    echo Mismatch in src/dst count: $src_count != $dst_count
    false
fi

echo Restored $dst_count test output files to $sites_out
