#!/bin/bash -e

UDMI_ROOT=$(dirname $0)/..
source $UDMI_ROOT/etc/shell_common.sh

[[ $# == 1 ]] || usage site_model

site_model=$(realpath $1)
shift

cd $UDMI_ROOT

docker rm udmis || true

cmd="docker run -d --name udmis -p 8883:8883 \
       -v $site_model:/root/site \
       -v $PWD/var/etcd:/root/default.etcd \
       -v $PWD/var/mosquitto:/etc/mosquitto \
       udmis:latest udmi/bin/start_local site //mqtt/localhost"

echo exec: $cmd
$cmd

echo

docker ps
