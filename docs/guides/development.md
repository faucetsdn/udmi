[**UDMI**](../../) / [**Docs**](../) / [**Guides**](./) / [Development](#)

# Development 

## Schema Documentation

The schema documentation in [`gencode/docs`](../../gencode/docs) must be kept up to date with any changes to the schema. Any additions to the schema should also include [annotations](https://json-schema.org/draft/2020-12/json-schema-validation.html#rfc.section.9.1) to describe the new elements. The updated documentation is generated by running the script `bin/gendocs` and its output committed to the repository with the changes. Required python dependencies are in [`etc/requirements.txt`](../../etc/requirements.txt) which must be installed for the script to run.

### Troubleshooting

`gendocs` requires a compatible system - required python modules installed match
the versions in `etc/requirements.txt`, and GNU `sed` and `find`. An unsupported
system will generate documentation with changes, even when the underlying schema
has not changed. `gendocs` works best under Linux. 

New schema files should automatically receive an entry in the index
`gencode/docs/readme.md` file if they are not referenced by any other schema
file. If a schema file is referenced by another schema file, but should still
have an entry in the index page, then the name should be added to the  to the
`ALWAYS_ROOT` list in `bin/gencode_root_schemas`. 

Entries in the index `gencode/docs/readme.md` page sectioned according to the
value of `$section` in the schema file. The section must also exist in the
template `etc/schema_readme_template.md`, and must match (case sensitive) the
value of `$section`, otherwise the schema entry is inserted under the `Other`
section

## Configuring Cloud CI Tests

To enable the CI tests, there first needs to be a dedicated GCP Project with an IoT Core
registry which mirrors the [example site model](https://github.com/faucetsdn/udmi_site_model).
A Github secret must also configured to point to the GCP project

They key steps to setup the dedicated project are as follows:
1.  Setup up a GCP Project and IoT Core Registry. The 
    [cloud setup](../cloud/gcp/cloud_setup.md) and [dashboard setup](../cloud/gcp/dashboard.md) documents 
    give guidance on this. If GCP Cloud SDK and Firebase CLI are already
    installed, re-authentication may be required. The registry name and cloud
    region are as follows:
    -   **Registry Name**: ZZ-TRI-FECTA
    -   **Cloud Region**: us-central1
2.  Setup the site model by cloning the 
    [example site model](https://github.com/faucetsdn/udmi_site_model) 
    in the udmi root directory and running the [registrar](../tools/registrar.md) 
    tool to configure the site model in the IoT Core Registry.
    -   `git clone https://github.com/faucetsdn/udmi_site_model.git`
    -   `bin/registar <GCP_PROJECT_ID> udmi_site_model`
2.  Set up the [sequence tests](../tools/sequencer.md). The public key used for the
    virtual device in the IoT Core registry is the public key from
    [`udmi_site_model/devices/AHU-1/rsa_public.pem`](https://raw.githubusercontent.com/faucetsdn/udmi_site_model/master/devices/AHU-1/rsa_public.pem).
    A `validator_config.json` configuration file is not needed (this is
    generated automatically during the CI test)
    -   The registry name is **ZZ-TRI-FECTA**. 
4.  A Github Secret needs to be added to the project. This is accessed from the
    Project's _Settings_ page. The secret is as follows:
        -   **Name**: GCP_TARGET_PROJECT
        -   **Value**: _GCP Project ID_
5.  Enable Github Actions

The workflow can be tested with an empty commit 
(`git commit --allow-empty -m "Blank commit to trigger CI"; git push`). 
On an unmodified branch, these tests should pass if correctly configured

